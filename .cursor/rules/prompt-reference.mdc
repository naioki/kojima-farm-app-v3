---
description: 注文解析・プロンプト・マスタを触る際はプロンプト内容整理.mdを参照する
alwaysApply: true
---

# Kojima-farm-app-v3 作業時の参照ドキュメント

**このプロジェクト（kojima-farm-app-v3）で作業するときは、毎回 `docs/プロンプト内容整理.md` を参照すること。**

- 注文解析ロジック（`order_processing.py`）の変更
- 画像・メール解析プロンプトの修正
- 品目・規格マスタ（`config/item_spec_master.json`）や計算ルールの変更
- 合計数量・箱数・端数・受信方法（総数/箱数）の仕様確認

**⚠️ 致命的ルール（必ず守る）**  
注文の「×」の直後の数字は**合計数量（総数）**であり、箱数ではない。例：胡瓜3本×150→total=150（150箱→total=4500 は誤り）。春菊×20→total=20（total=600 は誤り）。この解釈をプロンプトやコードで逆転させないこと。詳細は `docs/計算ロジックと品質保証.md` の「致命的に守るべきルール」。

上記に限らず、**プロンプトやマスタ・計算仕様に触れる前に** `docs/プロンプト内容整理.md` を開き、次の内容を確認してから修正する。**箱数・端数の割り算ロジック**を触る場合は、さらに `docs/計算ロジックと品質保証.md` と `box_remainder_calc.py` を参照し、直書きの `//` / `%` を追加しないこと。

- 画像解析用・メール用プロンプトの構成とルール
- 品目・規格マスタの表（入数・受信方法）
- 規格が1つの品目（春菊・青梗菜）の省略ルール
- 平箱の箱数扱い、長ネギ2本の入数（30）など正解データ
- 合計数量・箱数・端数の定義（AIは total のみ、Python で箱数・端数計算）
- 実行時に組み立てられる変数（store_list, unit_lines, box_count_str, spec_master_section）

文言やルールを変える場合は、`プロンプト内容整理.md` に書かれている仕様と矛盾しないようにし、必要ならドキュメント側も同時に更新する。
